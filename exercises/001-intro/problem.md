# 演習 001 — Introduction — sum（合計）

## 目的

- JSON-RPC 2.0 のメソッド `sum` を実装します。`sum` は位置引数で与えられた数値の配列を受け取り、その合計を返します。学習目的は基本的なリクエスト／レスポンス処理、通知の扱い、エラー応答を理解することです。

## 仕様

### JSON-RPC フィールド

- `jsonrpc`: リクエスト・レスポンスともに文字列 `"2.0"` を使用すること。  
- `method`: 実装対象のメソッド名は `"sum"`。  
- `params`: 位置引数で 1 個。数値の配列（例: `[1,2,3]`）。名前付き引数はサポートしてもしなくても良いが、テストは位置引数を使用する。  
- `result`: 正常時は入力配列内の数値総和を数値で返すこと。

### 型・振る舞い

- 配列内の要素はすべて数値であると期待する。空配列は `0` を返す。  
- 浮動小数点や負の数を含めても合計を計算すること（ホスト言語の数値表現に依存する）。

## エラー処理

次の条件でエラーを返すこと。可能なら標準の JSON-RPC エラーコードを使用する。

- `-32602` Invalid params  
  - `params` が欠落している。  
  - `params` が配列でない（例: オブジェクトや単一数値、文字列）。  
  - `params` が配列だが、その要素のいずれかが数値でない（例: `null`、文字列、オブジェクト）。
- `-32601` Method not found  
  - `method` が `"sum"` でない場合（テストでは対象外だが実装環境で考慮すること）。
- `-32700` Parse error  
  - 無効な JSON を受け取った場合はパースエラーを返す（この場合 `id` は `null` にすべきである）。
- `-32600` Invalid Request  
  - JSON は有効でも JSON-RPC オブジェクトの要件を満たさない場合（例: オブジェクトでない、`jsonrpc` フィールドが欠落／不正）。
- `-32603` Internal error  
  - 処理中のサーバ内部エラー（例外発生など）。

通知（`id` が存在しないリクエスト）はレスポンスを返してはならない。

## 注意点 / エッジケース

実装時に考慮すべき点:

- 空配列 → 合計は `0` を返す。  
- `id` が `null` のリクエストは通常のリクエストと同様に処理し、エラーや結果のレスポンスに `id: null` を返す（ただし通知は `id` 自体が欠落している場合）。
- 大きな数（オーバーフロー）や浮動小数点丸め誤差はホスト言語に依存する。必要なら明記する。
- パラメータの型検証は厳密に行うこと（配列であること、配列要素が数値であること）。
- 混合バッチ（通知 + 正常リクエスト + 不正なオブジェクト）が来た場合は、JSON-RPC 2.0 の仕様に従いそれぞれに対して個別に応答する（通知には応答しない）。

## 例

### 正常リクエスト

```json
{"jsonrpc":"2.0","method":"sum","params":[1,2,3],"id":1}
```

期待レスポンス:

```json
{"jsonrpc":"2.0","result":6,"id":1}
```

### エッジ（空配列）

リクエスト:

```json
{"jsonrpc":"2.0","method":"sum","params":[],"id":2}
```

期待レスポンス:

```json
{"jsonrpc":"2.0","result":0,"id":2}
```

### 無効（パラメータ不正）

リクエスト:

```json
{"jsonrpc":"2.0","method":"sum","params":[1,"x",3],"id":3}
```

期待レスポンス（例）:

```json
{"jsonrpc":"2.0","error":{"code":-32602,"message":"Invalid params"},"id":3}
```

## 受け入れ条件

- ソリューションは `tests/001-intro/` に置かれた `request-*.json` を読み込み、対応する `expected-*.json` と一致する JSON を標準出力または指定の出力先に出力できること。  
- 最低 3 件のテストペアを満たすこと:  
  - `0001` — 正常系（位置引数の配列、合計を返す）  
  - `0002` — エッジ（空配列 → `0`）  
  - `0003` — 無効/悪意（パラメータ型不正 → `-32602`）
- 通知（`id` 欠落）のリクエストに対しては何も出力しないこと（`expected-*.json` に該当レスポンスを含めない）。  
- バッチ応答を返す場合は配列形式とし、順序が許容される場合は `.meta.json` に明記すること。

## テスト

実装者は `tests/001-intro/` にあるフィクスチャを使って動作を検証すること。最低 3 つのテストシナリオは上記の通りで、追加で通知や混合バッチ、`id` が `null` のケースを用意することを推奨します。

## 難易度

⭐（入門）

## 実装者向けメモ

- 問題文は実装者が一意に挙動を決定できるように簡潔に記述しています。テストは JSON フィクスチャに基づくため、非決定的な出力は避けてください。
